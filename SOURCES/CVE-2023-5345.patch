From bae9ff4745a86b823585a4804488544422a1f37d Mon Sep 17 00:00:00 2001
From: Ryan Sullivan <rysulliv@redhat.com>
Date: Wed, 29 Nov 2023 11:58:47 -0500
Subject: [KPATCH CVE-2023-5345] kpatch fixes for CVE-2023-5345

Kernels:
5.14.0-362.8.1.el9_3


Kpatch-MR: https://gitlab.com/redhat/prdsc/rhel/src/kpatch/rhel-9/-/merge_requests/73
Changes since last build:
[x86_64]:
fs_context.o: changed function: smb3_fs_context_parse_param
igb_main.o: changed function: igb_configure

[ppc64le]:
fs_context.o: changed function: smb3_fs_context_parse_param

---------------------------

Modifications: none

commit df31b13c18bb024dada6d091437f4eb48ea3e7ae
Author: Scott Mayhew <smayhew@redhat.com>
Date:   Tue Oct 24 13:16:35 2023 -0400

    fs/smb/client: Reset password pointer to NULL

    JIRA: https://issues.redhat.com/browse/RHEL-11804
    JIRA: https://issues.redhat.com/browse/RHEL-11808
    CVE: CVE-2023-5345
    Conflicts: Different file path due to RHEL 9.3 not having 38c8a9a52082
            ("smb: move client and server files to common directory fs/smb").

    commit e6e43b8aa7cd3c3af686caf0c2e11819a886d705
    Author: Quang Le <quanglex97@gmail.com>
    Date:   Fri Sep 29 00:44:13 2023 +0700

        fs/smb/client: Reset password pointer to NULL

        Forget to reset ctx->password to NULL will lead to bug like double free

        Cc: stable@vger.kernel.org
        Cc: Willy Tarreau <w@1wt.eu>
        Reviewed-by: Namjae Jeon <linkinjeon@kernel.org>
        Signed-off-by: Quang Le <quanglex97@gmail.com>
        Signed-off-by: Steve French <stfrench@microsoft.com>

    Signed-off-by: Scott Mayhew <smayhew@redhat.com>

Signed-off-by: Ryan Sullivan <rysulliv@redhat.com>
---
 fs/cifs/fs_context.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/fs/cifs/fs_context.c b/fs/cifs/fs_context.c
index d3f176c9f302..630a94fc2988 100644
--- a/fs/cifs/fs_context.c
+++ b/fs/cifs/fs_context.c
@@ -1482,6 +1482,7 @@ static int smb3_fs_context_parse_param(struct fs_context *fc,
 
  cifs_parse_mount_err:
 	kfree_sensitive(ctx->password);
+	ctx->password = NULL;
 	return -EINVAL;
 }
 
-- 
2.42.0


